tests:
  - name: test
    target: checkout-system
    testPattern:
      - startAt: 1s
        scenario: scenario1

services:
  - name: cart-service
    port: 60000
    protocol: rest
  - name: checkout-service
    port: 60000
    protocol: rest

endpoints:
  - name: cart-service
    path: "/cart/user_id/{user_id}"
    service: cart-service
    methods:
      - type: 'POST'
        name: cart-service-post
      - type: 'GET'
        name: cart-service-get
  - name: checkout-service
    path: "/checkout"
    service: checkout-service
    methods:
      - type: 'POST'
        name: checkout-service-post

scenarios:
  - name: scenario1
    steps:
      - request: addCartRequest
      - request: getCartRequest
      - asserts: requests.getCartRequest.res.user_id == "abcde"
      - request: checkoutRequest
      - asserts: requests.checkoutRequest.res.items[0].item.product_id == "OLJCESPC7Z"

requests:
  - name: addCartRequest
    endpoint: cart-service
    method: cart-service-post
    requestValue:
      blob: |
            {
                "product_id": "OLJCESPC7Z",
                "quantity": 1
            }
      params:
        - name: user_id
          in: path
          value: abcde

  - name: getCartRequest
    endpoint: cart-service
    method: cart-service-get
    requestValue:
      params:
      - name: user_id
        in: path
        value: abcde

  - name: checkoutRequest
    endpoint: checkout-service
    method: checkout-service-post
    requestValue:
      blob: |
       {
           "user_id": "abcde",
           "user_currency": "UDS",
           "address": {
             "street_address": "1600 Amp street",
             "city": "Mountain View",
             "state": "CA",
             "country": "USA",
             "zip_code": "94043"
           },
           "email": "someone@example.com",
           "credit_card": {
             "credit_card_number": "4432-8015-6251-0454",
             "credit_card_cvv": 672,
             "credit_card_expiration_year": 24,
             "credit_card_expiration_month": 1
           }
        }

